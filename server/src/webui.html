<!DOCTYPE html>
<head>
  <meta charset="UTF-8" />
  <script>
    async function apply() {
        const code = document.querySelector('#code').value
        const types = document.querySelector('#types').value
        const policies = document.querySelector('#policies').value
        const res = await fetch(
            '/apply',
            {
                body: JSON.stringify({code, types, policies}),
                method: 'POST',
            }
        );

        const applyOutput = document.querySelector('#apply-output');
        if (!res.ok) {
            applyOutput.innerHTML = await res.text()
        } else {
            applyOutput.innerHTML = "OK";
        }
    }
    async function invoke() {
        const res = await fetch('http://localhost:8080/dev/ep1');
        document.querySelector('#response').innerHTML = await res.text()
    }
  </script>
</head>
<body>
  <h1>ChiselStrike in Your Browser</h1>
  <div>
    <label for="code">Code:</label><textarea id="code">
import { RouteMap } from "@chiselstrike/api";
export const routeMap = new RouteMap();
routeMap.get("/ep1", async function (req) {
    return new Response("hello");
});
export const topicMap = undefined;
    </textarea>
    <label for="types">Types:</label><textarea id="types"></textarea>
    <label for="policies">Policies:</label><textarea id="policies"></textarea>
    <button onclick="apply()">Apply</button>
  </div>
  <div id="apply-output"></div>
  <div>
    <button onclick="invoke()">Invoke /dev/ep1</button>
    <textarea id="response" readonly="true" placeholder="Route result will appear here."></textarea>
  </div>
</body>
